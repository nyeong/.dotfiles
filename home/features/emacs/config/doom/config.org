#+TITLE: My Emacs Config

* Initalize

#+begin_src elisp :tangle config.el
;;; config.el -*- lexical-binding: t; -*-

(setq user-full-name "An Nyeong"
      user-mail-address "me@annyeong.me")

;; secrets.el íŒŒì¼ ë¡œë“œ (API í‚¤ ë“± ë¯¼ê°í•œ ì •ë³´)
(let ((secret-file (expand-file-name "secrets.el" doom-private-dir)))
  (when (file-exists-p secret-file)
    (load secret-file)))
#+end_src

* Editor Config

#+begin_src elisp :tangle config.el
(setq-default
 tap-width 2
 evil-shift-width 2
 indent-tabs-mode nil
 standard-indent 2)
#+end_src

* ì™¸ê´€

#+begin_src elisp :tangle config.el
(setq doom-theme 'doom-one-light)
(setq display-line-numbers-type 'visual)
#+end_src

** í•œêµ­ì–´

#+begin_src elisp :tangle config.el
(set-language-environment "Korean")
(prefer-coding-system 'utf-8)
(set-default-coding-systems 'utf-8)
(set-terminal-coding-system 'utf-8)
(set-keyboard-coding-system 'utf-8)
(setq-default buffer-file-coding-system 'utf-8)
(if (fboundp 'w32-set-system-coding-system)
    (w32-set-system-coding-system 'utf-8))
;; ë‚ ì§œ í‘œì‹œë¥¼ ì˜ì–´ë¡œí•œë‹¤. org modeì—ì„œ time stamp ë‚ ì§œì— ì˜í–¥ì„ ì¤€ë‹¤.
(setq system-time-locale "C")
(setenv "LANG" "en_US.UTF-8")
(setenv "LC_ALL" "en_US.UTF-8")
#+end_src

** ê¸€ê¼´

|   1245678 |   |
|-----------+---|
| oneë‘˜ì‚¼ë„· |   |
|           |   |

#+begin_src elisp :tangle config.el
(setq doom-font (font-spec :family "Monoplex KR Wide Nerd" :size 14 :weight 'semi-light))
;;       doom-variable-pitch-font (font-spec :family "Liga SFMono Nerd Font" :size 14 :weight 'semi-light)
;;       doom-serif-font (font-spec :family "Liga SFMono Nerd Font" :size 14 :weight 'semi-light))

(set-face-attribute 'default nil :family "Monoplex KR Wide Nerd")
;; (set-face-attribute 'default nil :family "Liga SFMono Nerd Font")
;; (set-fontset-font "fontset-default" '(#x1100 . #xffdc) (font-spec :family "Monoplex KR Nerd"))
;; (set-fontset-font "fontset-default" '(#xe0bc . #xf66e) (font-spec :family "Monoplex KR Nerd"))
;; (set-fontset-font "fontset-default" 'hangul (font-spec :family "Monoplex KR Nerd"))
(set-face-attribute 'default nil :height 140)
(set-default 'line-spacing 3)

;; (setq face-font-rescale-alist
;;       '((".*hiragino.*" . 1.2)
;;         ("Monoplex KR Wide Nerd" . 1.0)))
#+end_src

* vterm

TRAMPë¡œ ì ‘ì† ì‹œì—ë„ vtermì„ ë¡œê·¸ì¸ì…¸ë¡œ ì“°ê¸° ìœ„í•¨

#+begin_src elisp :tangle config.el
(setq shell-file-name "zsh")
(setq vterm-shell "zsh -l")
#+end_src

* Org

#+begin_src elisp :tangle config.el
(setq org-directory "~/hanassig/")
(after! org-roam
  (setq org-roam-directory (file-truename "~/hanassig")
        epa-pinentry-mode 'loopback
        org-roam-node-template "#+TITLE: ${title}\n"))
#+end_src

** org-latex

#+begin_src elisp :tangle config.el
(after! org
  (setq org-latex-compiler "xelatex")
  (setq org-latex-pdf-process
      '("latexmk -xelatex -interaction=nonstopmode -output-directory=%o %f")))
(after! ox-latex
  (add-to-list 'org-latex-default-packages-alist '("cjk" "kotex" nil)))
#+end_src

** org-test

#+begin_src elisp :tangle config.el
(use-package! org-test)
#+end_src

** org-ql

#+begin_src elisp :tangle config.el
(use-package! org-ql
  :after org)
#+end_src

** ê¸°ë³¸ ì„¤ì •

#+begin_src elisp :tangle config.el
;; í”½ì…€ ë‹¨ìœ„ ìŠ¤í¬ë¡¤
(pixel-scroll-precision-mode t)
#+end_src

** í…œí”Œë¦¿
:PROPERTIES:
:MODIFIED: <2025-11-20 Thu>
:END:

#+begin_src elisp :tangle config.el
;; ê¸°ë³¸ í…œí”Œë¦¿
(setq org-roam-capture-templates
  ;; "d" :: í‚¤
  ;; "default" :: ì´ë¦„
  `(("d" "default" plain
    ;; ë…¸íŠ¸ì— ì‚½ì…ë  ë‚´ìš©
    "%?"
    ;; ìƒˆ íŒŒì¼ì¼ ê²½ìš°
    :target (file+head "%<%Y%m%d%H%M%S>-${slug}.org"
                        ,(concat
                          ":PROPERTIES:\n"
                          ":CREATED: <%<%Y-%m-%d %a>>\n"
                          ":MODIFIED: <%<%Y-%m-%d %a>>\n"
                          ":END:\n"
                          "#+TITLE: ${title}\n\n"))
    ;; ensures that the full file will be displayed when captured.
    :unnarrowed t)))

;; í”„ë¡œì íŠ¸ í…œí”Œë¦¿
(defvar nyeong/project-template
  `("p" "Project" plain
    "%?"
    :target (file+head "projects/${slug}.org"
                       ,(concat
                         ":PROPERTIES:\n"
                         ":CREATED: <%<%Y-%m-%d %a>>\n"
                         ":MODIFIED: <%<%Y-%m-%d %a>>\n"
                         ":END:\n\n"
                         "#+title: ${title}\n"
                         "#+DESCRIPTION: \n"))
    :unnarrowed t)
  "í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ org-roam ìº¡ì²˜ í…œí”Œë¦¿.
- ${title}: ë¬¸ì„œ ì œëª©")

;; ì˜ì—­ í…œí”Œë¦¿
(defvar nyeong/area-template
  `("a" "Area" plain
    "%?"
    :target (file+head "areas/${slug}.org"
                       ,(concat
                         ":PROPERTIES:\n"
                         ":CREATED: <%<%Y-%m-%d %a>>\n"
                         ":MODIFIED: <%<%Y-%m-%d %a>>\n"
                         ":END:\n"
                         "#+TITLE: ${title}\n"
                         "#+DESCRIPTION: \n"))
    :unnarrowed t)
  "ì˜ì—­(Area)ì„ ìœ„í•œ org-roam ìº¡ì²˜ í…œí”Œë¦¿.
- ${title}: ë¬¸ì„œ ì œëª©")

;; ë…¸íŠ¸ í…œí”Œë¦¿
(defvar nyeong/note-template
  `("n" "Note" plain
    "%?"
    :target (file+head "notes/${slug}.org"
                       ,(concat
                         ":PROPERTIES:\n"
                         ":CREATED: <%<%Y-%m-%d %a>>\n"
                         ":MODIFIED: <%<%Y-%m-%d %a>>\n"
                         ":END:\n\n"
                         "#+TITLE: ${title}\n"
                         "#+DESCRIPTION: \n"))
    :unnarrowed t)
  "ê°œë… ì •ë¦¬ë¥¼ ìœ„í•œ org-roam ìº¡ì²˜ í…œí”Œë¦¿.
- ${title}: ë¬¸ì„œ ì œëª©")

;; inbox ìº¡ì²˜ í…œí”Œë¦¿
(defvar nyeong/inbox-template
  `("i" "Inbox" plain
    "* %U\n\n%?"
    :target (file+head "inbox/capture.org"
                       ,(concat
                         ":PROPERTIES:\n"
                         ":CREATED: <%<%Y-%m-%d %a>>\n"
                         ":MODIFIED: <%<%Y-%m-%d %a>>\n"
                         ":END:\n"
                         "#+TITLE: ìº¡ì²˜ ë°•ìŠ¤\n"))
    :unnarrowed t)
  "ìº¡ì²˜")

;; ë ˆí¼ëŸ°ìŠ¤ í…œí”Œë¦¿
(defvar nyeong/reference-template
  `("r" "Reference" plain "%?"
    :target (file+head "references/${citekey}.org"
                       ,(concat
                         ":PROPERTIES:\n"
                         ":ROAM_REFS: [cite:@${citekey}] ${url}\n"
                         ":CREATED: [%<%Y-%m-%d %a>]\n"
                         ":MODIFIED: [%<%Y-%m-%d %a>]\n"
                         ":END:\n"
                         "#+TITLE: ${title}\n"))
    :immediate-finish t
    :unnarrowed t)
  "ì°¸ê³  ë¬¸í—Œì„ ìœ„í•œ org-roam ìº¡ì²˜ í…œí”Œë¦¿.
- ${citekey} : ì¸ìš©í‚¤
- ${title}: ë¬¸ì„œ ì œëª©
- ${url}: ì›¹ ì£¼ì†Œ (ìˆëŠ” ê²½ìš°)")

(after! org-roam
  (add-to-list 'org-roam-capture-templates nyeong/project-template)
  (add-to-list 'org-roam-capture-templates nyeong/area-template)
  (add-to-list 'org-roam-capture-templates nyeong/note-template)
  (add-to-list 'org-roam-capture-templates nyeong/reference-template)
  (add-to-list 'org-roam-capture-templates nyeong/inbox-template))
#+end_src

** ìˆ˜ì • ì‹œê°„ ìë™ ì—…ë°ì´íŠ¸

#+begin_src elisp :tangle config.el
(defun nyeong/update-last-modified ()
  "Update the LAST_MODIFIED property in the current buffer."
  (when (derived-mode-p 'org-mode)
    (save-excursion
      (goto-char (point-min))
      (when (re-search-forward ":MODIFIED:" nil t)
        (org-set-property "MODIFIED"
                         (format-time-string "<%Y-%m-%d %a>"))))))

(defun nyeong/upcase-org-title ()
  "Convert #+title: to #+TITLE: in org files."
  (when (derived-mode-p 'org-mode)
    (save-excursion
      (goto-char (point-min))
      (while (re-search-forward "^#\\+title:" nil t)
        (replace-match "#+TITLE:" t)))))

(add-hook 'before-save-hook #'nyeong/update-last-modified)
(add-hook 'before-save-hook #'nyeong/upcase-org-title)
#+end_src

** Biblio

ê¸°ë³¸ì ì¸ ì„¤ì •ì€ ì•„ë˜ì™€ ê°™ìŒ

#+begin_src elisp :tangle config.el
(after! org
  (setq org-agenda-files '("~/hanassig/journals/weekly"
                          "~/hanassig/projects"
                          "~/hanassig/areas")
        org-cite-export-processors '((t csl))
        org-cite-csl-styles-dir "~/hanassig/csl-styles"
        org-cite-csl-default-style "ieee"
        org-cite-global-bibliography '("~/hanassig/references.bib")))
(setq! citar-bibliography '("~/hanassig/references.bib"))
#+end_src

ìœ„ì˜ =references.bib=ì—ì„œ í•˜ë‚˜ì”© ê°€ì ¸ì™€ì„œ í…œí”Œë¦¿ìœ¼ë¡œ ë§Œë“œëŠ” í•¨ìˆ˜. [[https://jethrokuan.github.io/org-roam-guide/][How I Take Notes with Org-roam]] ì°¸ê³ í•˜ì˜€ê³ , APIê°€ ë°”ë€Œì–´ì„œ ìˆ˜ì •í•˜ì˜€ë‹¤:

#+begin_src elisp :tangle config.el
(defun nyeong/format-authors (author-string)
  "ì €ì ë¬¸ìì—´ì„ 'ì„±1 & ì„±2' ë˜ëŠ” 'ì„±1 et al.' í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤."
  (if (not author-string)
      "Unknown"
    (let ((authors (split-string author-string " and ")))
      (cond
       ;; ë‹¨ì¼ ì €ì
       ((= (length authors) 1)
        (if (string-match "\\(.*\\), \\(.*\\)" (car authors))
            (match-string 1 (car authors))  ;; ì„±ë§Œ ì‚¬ìš©
          (car authors)))

       ;; ë‘ ëª…ì˜ ì €ì
       ((= (length authors) 2)
        (concat (if (string-match "\\(.*\\), \\(.*\\)" (car authors))
                    (match-string 1 (car authors))
                  (car authors))
                " & "
                (if (string-match "\\(.*\\), \\(.*\\)" (cadr authors))
                    (match-string 1 (cadr authors))
                  (cadr authors))))

       ;; ì„¸ ëª… ì´ìƒì˜ ì €ì
       (t
        (concat (if (string-match "\\(.*\\), \\(.*\\)" (car authors))
                    (match-string 1 (car authors))
                  (car authors))
                " et al."))))))

(defun nyeong/get-entry-value (entry key &optional default)
  "BibTeX entryì—ì„œ keyì— í•´ë‹¹í•˜ëŠ” ê°’ì„ ê°€ì ¸ì˜¤ê³  ì—†ìœ¼ë©´ default ë°˜í™˜"
  (let ((value (citar-format--entry (format "${%s}" key) entry)))
    (if (or (null value) (string-empty-p value))
        default
      value)))

(defun nyeong/create-reference-from-cite (citekey)
  (interactive (list (citar-select-ref)))
  (let* ((entry (citar-get-entry citekey))
         (raw-title (nyeong/get-entry-value entry "title" "Untitled"))
         (author (nyeong/format-authors (nyeong/get-entry-value entry "author" nil)))
         (year (nyeong/get-entry-value entry "year" "n.d."))
         (title (format "%s (%s, %s)" raw-title author year))
         (url (or (nyeong/get-entry-value entry "url" nil)
                  (nyeong/get-entry-value entry "howpublished" nil)
                  "")))
    (org-roam-capture- :templates (list nyeong/reference-template)
                       :info (list :citekey citekey
                                   :title title
                                   :url url)
                       :node (org-roam-node-create :title title)
                       :props (list :finalize 'find-file))))
#+end_src

** babel
*** tangle ì „ ë””ë ‰í† ë¦¬ ìë™ ìƒì„±

org-babel-tangleì´ ê²½ë¡œë¡œ ì§€ì •ëœ ê²½ìš°, ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ìë™ ìƒì„±

#+begin_src elisp :tangle config.el
(defun nyeong/org-babel-tangle-ensure-directory (file)
  "Ensure the directory for FILE exists."
  (let ((dir (file-name-directory file)))
    (unless (file-directory-p dir)
      (make-directory dir t))))

(add-hook 'org-babel-pre-tangle-hook
          (lambda ()
            (let ((tangle-file (org-entry-get nil "TANGLE")))
              (when (and tangle-file (string-match-p "/" tangle-file))
                (nyeong/org-babel-tangle-ensure-directory tangle-file)))))
#+end_src

*** d2

ìŒˆë°•í•œ text diagram ë¼ì´ë¸ŒëŸ¬ë¦¬

#+begin_src elisp :tangle config.el
(after! (:and org ob-d2)
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((d2 . t))))
#+end_src

** org-ps

#+begin_src elisp :tangle config.el
(use-package! org-ps
 :load-path "/Users/nyeong/Repos/org-ps.el"
 :config
 (defun org-ps-cpp--compile-cmd (source-file output-file)
   (list "nix" "shell" "nixpkgs#clang" "nixpkgs#catch2_3" "--command"
       "bash" "-c"
       (format
        "catch2_path=$(nix eval --raw nixpkgs#catch2_3.outPath) && \\\n          clang++ %s -o %s \\\n          -I\"$catch2_path/include\" \\\n          -L\"$catch2_path/lib\" \\\n          -lCatch2Main -lCatch2 \\\n          -std=c++20 -O2 -Wall -Werror -Wpedantic -Wextra"
        (shell-quote-argument source-file)
        (shell-quote-argument output-file))))

 (defun org-ps-cpp--execute-cmd (executable-file)
   (list executable-file "--durations" "yes"))

 (defun org-ps-cpp--template-fn (solution-code test-code)
   "Generate single C++ code by concatenating SOLUTION-CODE and TEST-CODE."
   (concat
    "#include <catch2/catch_test_macros.hpp>\n"
    "#include <vector>\n"
    "#include <string>\n"
    "#include <iostream>\n"
    "#include <algorithm>\n\n"
    "using namespace std;\n\n"
    solution-code "\n\n"
    test-code))

 (defun org-ps-cpp--edit-prep-fn (babel-info)
   (let* ((header-params (nth 2 babel-info))
        (tangle-file (alist-get :tangle header-params))
        (project-root (expand-file-name "~/hanassig/"))
        (file-path (if (and tangle-file (not (string= tangle-file "no")))
                  (expand-file-name tangle-file project-root)
                 (expand-file-name "temp.cpp" project-root)))
        (compile-commands (expand-file-name "compile_commands.json" project-root)))
     (setq-local buffer-file-name file-path)
     (setq-local default-directory project-root)

     (when (and (fboundp 'lsp!) (not lsp-mode)) (lsp!))))

 (org-ps--register-backend "cpp"
                   (list :compile-cmd #'org-ps-cpp--compile-cmd
                       :execute-cmd #'org-ps-cpp--execute-cmd
                       :template-fn #'org-ps-cpp--template-fn
                       :edit-prep-fn #'org-ps-cpp--edit-prep-fn
                       :file-ext "cpp"))

   (defun org-ps-rust--compile-cmd (source-file output-file)
    (list "nix" "shell" "nixpkgs#rustc" "--command"
          "bash" "-c"
          (format
           "rustc %s -o %s --edition 2021 -C opt-level=2 -C debuginfo=0 --test"
           (shell-quote-argument source-file)
           (shell-quote-argument output-file))))

  (defun org-ps-rust--execute-cmd (executable-file)
    (list executable-file "--show-output"))

  (defun org-ps-rust--template-fn (solution-code test-code)
    "Generate single Rust test file by concatenating SOLUTION-CODE and TEST-CODE."
    (concat
     solution-code "\n\n"
     "#[cfg(test)]\n"
     "mod tests {\n"
     "    use super::*;\n\n"
     test-code "\n"
     "}\n"))

   (defun org-ps-rust--edit-prep-fn (babel-info)
  (let* ((header-params (nth 2 babel-info))
         (tangle-file (alist-get :tangle header-params))
         ;; ì„ì‹œ ë²„í¼ì˜ ë””ë ‰í† ë¦¬
         (temp-root (file-name-directory (buffer-file-name)))
         (cargo-toml (expand-file-name "Cargo.toml" temp-root)))

    ;; ë”ë¯¸ Cargo.toml ìƒì„±
    (unless (file-exists-p cargo-toml)
      (with-temp-file cargo-toml
        (insert "[package]\n")
        (insert "name = \"hanassig\"\n")
        (insert "version = \"0.1.0\"\n")
        (insert "edition = \"2021\"\n")))

    (setq-local default-directory temp-root)
    (setq-local lsp-rust-analyzer-diagnostics-enable nil)

    (when (and (fboundp 'lsp!) (not lsp-mode)) (lsp!))))


  (org-ps--register-backend "rust"
                            (list :compile-cmd #'org-ps-rust--compile-cmd
                                  :execute-cmd #'org-ps-rust--execute-cmd
                                  :template-fn #'org-ps-rust--template-fn
                                  :edit-prep-fn #'org-ps-rust--edit-prep-fn
                                  :file-ext "rs"))

 )
#+end_src

* TRAMP
#+begin_src elisp :tangle config.el
(after! tramp
  (add-to-list 'tramp-remote-path 'tramp-own-remote-path))
#+end_src

* ì–¸ì–´ë³„ ì„¤ì •
** C++
#+begin_src elisp :tangle config.el
(after! lsp-clangd
  (setq lsp-clients-clangd-args
        '("-j=3"
          "--background-index"
          "--clang-tidy"
          "--completion-style=detailed"
          "--header-insertion=never"
          "--header-insertion-decorators=0"
          "--pch-storage=memory"
          "--query-driver=/usr/bin/clang++,/Library/Developer/CommandLineTools/usr/bin/clang++"))
  (set-lsp-priority! 'clangd 2))

(after! ccls
  (setq ccls-initialization-options
        '(:index (:comments 2)
          :completion (:detailedLabel t)
          :clang (:extraArgs ["-std=c++20"]
                  :resourceDir "")))
  (set-lsp-priority! 'ccls 1))
#+end_src

** Nix
#+begin_src elisp :tangle config.el
(after! nix-mode
  (setq lsp-nix-nil-formatter ["nixfmt"]))
#+end_src

** Elixir
#+begin_src elisp :tangle config.el
(use-package lsp-mode
  :ensure t
  :config
  (setq lsp-modeline-code-actions-segments '(count icon name))

  :init
  '(lsp-mode))


(use-package elixir-mode
  :ensure t
  :custom
  (lsp-elixir-server-command '("nix run github:elixir-lang/expert")))
#+end_src

** Mermaid

#+begin_src elisp :tangle config.el
(org-babel-do-load-languages 'org-babel-load-languages
                             (append org-babel-load-languages
                                     '((mermaid . t)))
                             )
#+end_src

* LLM

[[https://github.com/milanglacier/minuet-ai.el][GitHub - milanglacier/minuet-ai.el: ğŸ’ƒ Dance with LLM in Your Code. Minuet off...]]

#+begin_src elisp :tangle config.el
(use-package! minuet
  :init
  (add-hook 'prog-mode-hook #'minuet-auto-suggestion-mode)
  :config
  (setq minuet-provider 'openai-fim-compatible)
  (minuet-set-optional-options minuet-openai-fim-compatible-options :max_tokens 64))
#+end_src
